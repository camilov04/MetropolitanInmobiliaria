{% extends "base.html" %}
{% block content %}

<div class="detalle-inmueble plan-{{ inmueble.plan|lower if inmueble.plan else 'none' }}">

<!-- ===== CARRUSEL ===== -->

<div class="carousel">

    <div class="carousel-main">

        <button class="carousel-btn prev">â€¹</button>

        <div class="carousel-viewport">
            <div class="carousel-track">
                {% for img in imagenes %}
                    <img src="{{ img }}" class="carousel-slide">
                {% endfor %}
            </div>
        </div>

        <button class="carousel-btn next">â€º</button>

    </div>

    <!-- DOTS -->
    <div class="carousel-dots">
        {% for img in imagenes %}
            <span class="dot"></span>
        {% endfor %}
    </div>

</div>


<!-- ===== INFO ===== -->

<h2>
    {{ inmueble.titulo }}

    {% if inmueble.plan_activo %}
        <span class="detalle-plan-badge badge-{{ inmueble.plan|lower }}">
            {{ inmueble.plan }}
        </span>
    {% endif %}
</h2>
<p class="ubicacion">{{ inmueble.municipio }}</p>

<div class="datos-clave">

```
<div class="dato precio">
    {{ inmueble.tipo_negocio }} Â· ${{ "{:,.0f}".format(inmueble.precio) }}
</div>

<div class="dato">{{ inmueble.tipo }}</div>

{% if inmueble.habitaciones %}
<div class="dato">ğŸ› {{ inmueble.habitaciones }}</div>
{% endif %}

{% if inmueble.banos %}
<div class="dato">ğŸš¿ {{ inmueble.banos }}</div>
{% endif %}

{% if inmueble.parqueadero %}
<div class="dato">ğŸš— Parqueadero</div>
{% endif %}
```

</div>


<hr>

<div class="detalle-descripcion">
    <h4>DescripciÃ³n</h4>
    <p>{{ inmueble.descripcion }}</p>
</div>

</div>


<!-- FULLSCREEN MODAL -->
<div id="fullscreenViewer" class="fullscreen-viewer">

    <button class="fs-close">âœ•</button>

    <button class="fs-arrow fs-prev">â€¹</button>

    <div class="fs-container">
        <div class="fs-track">

            {% for img in imagenes %}
                <div class="fs-slide-wrapper">
                    <img src="{{ img }}" class="fs-slide">
                </div>
            {% endfor %}

        </div>
    </div>

    <button class="fs-arrow fs-next">â€º</button>
    <div class="fs-counter">
        <span id="fsCurrent">1</span> / <span id="fsTotal">{{ imagenes|length }}</span>
    </div>


</div>



<script>
document.addEventListener("DOMContentLoaded", () => {

    const track = document.querySelector(".carousel-track");
    const slides = Array.from(track.children);

    const nextBtn = document.querySelector(".carousel-btn.next");
    const prevBtn = document.querySelector(".carousel-btn.prev");
    const dots = document.querySelectorAll(".dot");

    let index = 0;

    function updateCarousel() {
        track.style.transform = `translateX(-${index * 100}%)`;

        dots.forEach((dot, i) => {
            dot.classList.toggle("active", i === index);
        });
    }

    nextBtn.onclick = () => {
        index = (index + 1) % slides.length;
        updateCarousel();
    };

    prevBtn.onclick = () => {
        index = index === 0 ? slides.length - 1 : index - 1;
        updateCarousel();
    };

    dots.forEach((dot, i) => {
        dot.onclick = () => {
            index = i;
            updateCarousel();
        };
    });

    /* Swipe mÃ³vil */
    let startX = 0;

    track.addEventListener("touchstart", e => {
        startX = e.touches[0].clientX;
    });

    track.addEventListener("touchend", e => {
        let diff = startX - e.changedTouches[0].clientX;

        if (diff > 50) nextBtn.click();
        if (diff < -50) prevBtn.click();
    });

    updateCarousel();
});
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const viewer = document.getElementById("fullscreenViewer");
    const fsTrack = document.querySelector(".fs-track");
    const fsSlides = document.querySelectorAll(".fs-slide");

    const fsNext = document.querySelector(".fs-next");
    const fsPrev = document.querySelector(".fs-prev");
    const fsClose = document.querySelector(".fs-close");

    const slides = document.querySelectorAll(".carousel-slide");

    let fsIndex = 0;
    let scale = 1;

    /* ===== ABRIR FULLSCREEN ===== */
    slides.forEach((slide, i) => {
        slide.addEventListener("click", () => {
            viewer.classList.add("active");
            fsIndex = i;
            scale = 1;
            updateFS();
            
        });
    });

    function updateFS() {
    fsTrack.style.transform = `translateX(-${fsIndex * 100}%)`;

    document.getElementById("fsCurrent").textContent = fsIndex + 1;

    fsSlides.forEach(img => img.style.transform = "scale(1)");
    scale = 1;
    }

    /* ===== FLECHAS ===== */
    fsNext.onclick = () => {
        fsIndex = (fsIndex + 1) % fsSlides.length;
        updateFS();
    };

    fsPrev.onclick = () => {
        fsIndex = fsIndex === 0 ? fsSlides.length - 1 : fsIndex - 1;
        updateFS();
    };

    /* ===== CERRAR ===== */
    fsClose.onclick = () => viewer.classList.remove("active");
    viewer.onclick = (e) => {
        if (e.target === viewer) viewer.classList.remove("active");
        
    };
    

    /* ===== SWIPE MOVIL ===== */
    let startX = 0;

    viewer.addEventListener("touchstart", e => {
        startX = e.touches[0].clientX;
    });

    viewer.addEventListener("touchend", e => {
        let diff = startX - e.changedTouches[0].clientX;

        if (diff > 50) fsNext.click();
        if (diff < -50) fsPrev.click();
    });

    /* ===== ZOOM RUEDA MOUSE ===== */
    fsSlides.forEach(img => {

        img.addEventListener("wheel", e => {

            e.preventDefault();

            scale += e.deltaY * -0.001;
            scale = Math.min(Math.max(1, scale), 3);

            img.style.transform = `scale(${scale})`;

        });

    });

    /* ===== PINCH ZOOM MOVIL ===== */
    fsSlides.forEach(img => {

        let initialDistance = null;

        img.addEventListener("touchmove", e => {

            if (e.touches.length === 2) {

                let dx = e.touches[0].clientX - e.touches[1].clientX;
                let dy = e.touches[0].clientY - e.touches[1].clientY;
                let distance = Math.sqrt(dx * dx + dy * dy);

                if (!initialDistance) {
                    initialDistance = distance;
                } else {

                    scale = distance / initialDistance;
                    scale = Math.min(Math.max(1, scale), 3);

                    img.style.transform = `scale(${scale})`;
                }
            }

        });

        img.addEventListener("touchend", () => {
            initialDistance = null;
        });

    });

});
</script>

{% endblock %}
